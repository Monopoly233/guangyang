services:
  web:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "8088:80"
    depends_on:
      - go
    networks:
      - appnet

  go:
    build:
      context: ./gobackend
      dockerfile: Dockerfile
    environment:
      - PORT=8080
      - CORS_ALLOW_ORIGIN=*
      # WeChatPay config (建议用 .env 或 CI 变量注入；不要写死在这里)
      - WECHAT_NOTIFY_URL=${WECHAT_NOTIFY_URL:-}
      - WECHAT_MCHID=${WECHAT_MCHID:-}
      - WECHAT_APPID=${WECHAT_APPID:-}
      - WECHAT_API_V3_KEY=${WECHAT_API_V3_KEY:-}
    volumes:
      # 证书/密钥目录建议通过挂载或 secrets 注入
      - ./wechatpay:/app/wechatpay:ro
      - ./tmp:/app/tmp
    expose:
      - "8080"
    networks:
      - appnet

networks:
  appnet:
    driver: bridge

